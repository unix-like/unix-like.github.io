<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="本文原文出处:http://leslie-chu.blog.163.com/blog/static/19986324320125414618221 　　主要参考（所有权利归原文作者所有）： 　　http://www.cnblogs.com/endsock/archive/2011/12/09/2281519.html 　　http://blog.163.com/ninja_wk/blog/st">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux运维装逼指南">
<meta property="og:url" content="http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/index.html">
<meta property="og:site_name" content="Linux运维装逼指南">
<meta property="og:description" content="本文原文出处:http://leslie-chu.blog.163.com/blog/static/19986324320125414618221 　　主要参考（所有权利归原文作者所有）： 　　http://www.cnblogs.com/endsock/archive/2011/12/09/2281519.html 　　http://blog.163.com/ninja_wk/blog/st">
<meta property="og:updated_time" content="2017-05-25T03:35:10.192Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux运维装逼指南">
<meta name="twitter:description" content="本文原文出处:http://leslie-chu.blog.163.com/blog/static/19986324320125414618221 　　主要参考（所有权利归原文作者所有）： 　　http://www.cnblogs.com/endsock/archive/2011/12/09/2281519.html 　　http://blog.163.com/ninja_wk/blog/st">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Linux运维装逼指南</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/unix-like">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/05/25/application/Windows与Linux共享文件夹互相访问/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2017/05/25/application/ssd优化/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&text="><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&is_video=false&description="><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=&body=Check out this article: http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&name=&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Linux运维装逼指南</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-05-25T03:35:10.192Z" itemprop="datePublished">2017-05-25</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>　　本文原文出处:<a href="http://leslie-chu.blog.163.com/blog/static/19986324320125414618221" target="_blank" rel="external">http://leslie-chu.blog.163.com/blog/static/19986324320125414618221</a></p>
<p>　　主要参考（所有权利归原文作者所有）：</p>
<p>　　<a href="http://www.cnblogs.com/endsock/archive/2011/12/09/2281519.html" target="_blank" rel="external">http://www.cnblogs.com/endsock/archive/2011/12/09/2281519.html</a></p>
<p>　　<a href="http://blog.163.com/ninja_wk/blog/static/989155620084280154811/" target="_blank" rel="external">http://blog.163.com/ninja_wk/blog/static/989155620084280154811/</a></p>
<p>　　<a href="http://www.chinaunix.net/jh/4/16110.html" target="_blank" rel="external">http://www.chinaunix.net/jh/4/16110.html</a></p>
<hr>
<p>#一、TC原理</p>
<p>　　Linux操作系统中的流量控制器TC（Traffic Control）用于Linux内核的流量控制，主要是通过在输出端口处建立一个队列来实现流量控制。</p>
<p>　　接收包从输入接口进来后，经过流量限制丢弃不符合规定的数据包，由输入多路分配器进行判断选择：</p>
<ul>
<li>如果接收包的目的主机是本主机，那么将该包送给上层处理，否则需要进行转发，将接收包交到转发块（Forwarding Block）处理。</li>
<li>转发块同时也接收本主机上层(TCP、UDP等)产生的包，通过查看路由表，决定所处理包的下一跳。</li>
<li>然后，对包进行排列以便将它们送到输出接口。</li>
</ul>
<p>　　一般只能限制网卡发送的数据包，不能限制网卡接收的数据包，所以可以通过改变发送次序靠控制传输速率。Linux流量控制主要是在输出接口排列时进行处理和实现的。</p>
<p>#二、TC规则</p>
<p>##2.1、流量控制方式</p>
<p>　　流量控制包括以下几种方式：</p>
<ul>
<li>SHAPING(限制) </li>
</ul>
<p>　　当流量被限制，它的传输速率就被控制在某个值以下。限制值可以大大小于有效带宽，这样可以平滑突发数据流量，使网络更为稳定。shaping（限制）只适用于向外的流量。</p>
<ul>
<li>SCHEDULING(调度)      </li>
</ul>
<p>　　通过调度数据包的传输，可以在带宽范围内，按照优先级分配带宽。SCHEDULING(调度)也只适于向外的流量。</p>
<ul>
<li>POLICING(策略)      </li>
</ul>
<p>　　SHAPING用于处理向外的流量，而POLICIING(策略)用于处理接收到的数据。</p>
<ul>
<li>DROPPING(丢弃)      </li>
</ul>
<p>　　如果流量超过某个设定的带宽，就丢弃数据包，不管是向内还是向外。</p>
<p>##2.2、流量控制处理对象</p>
<p>　　流量的处理由三种对象控制，它们是：</p>
<ul>
<li>qdisc(排队规则)</li>
<li>class(类别)</li>
<li>filter(过滤器)</li>
</ul>
<p>###QDISC(排队规则)</p>
<p>　　QDisc(排队规则)是queueing discipline的简写，它是理解流量控制(traffic control)的基础。<strong>无论何时，内核如果需要通过某个网络接口发送数据包，它都需要按照为这个接口配置的qdisc(排队规则)把数据包加入队列。</strong> 然后，内核会尽可能多地从qdisc里面取出数据包，把它们交给网络适配器驱动模块。最简单的QDisc是pfifo它不对进入的数据包做任何的处理，数据包采用先入先出的方式通过队列。不过，它会保存网络接口一时无法处理的数据包。</p>
<p>　　QDISC的类别如下：</p>
<p>####（1）、CLASSLESS QDisc(不可分类QDisc)</p>
<p>#####1. 无类别QDISC包括：</p>
<p>　　<strong>[p|b]fifo</strong></p>
<p>　　使用最简单的qdisc，纯粹的先进先出。只有一个参数：limit，用来设置队列的长度,pfifo是以数据包的个数为单位；bfifo是以字节数为单位。</p>
<p>　　<strong>pfifo_fast</strong></p>
<p>　　在编译内核时，如果打开了高级路由器(Advanced Router)编译选项，pfifo_fast就是系统的标准QDISC。它的队列包括三个波段(band)。在每个波段里面，使用先进先出规则。而三个波段(band)的优先级也不相同，band 0的优先级最高，band 2的最低。如果band里面有数据包，系统就不会处理band 1里面的数据包，band 1和band 2之间也是一样。数据包是按照服务类型(Type of Service,TOS)被分配多三个波段(band)里面的。</p>
<p>　　<strong>red</strong></p>
<p>　　red是Random Early Detection(随机早期探测)的简写。如果使用这种QDISC，当带宽的占用接近于规定的带宽时，系统会随机地丢弃一些数据包。它非常适合高带宽应用。</p>
<p>　　<strong>sfq</strong></p>
<p>　　sfq是Stochastic Fairness Queueing的简写。它按照会话(session–对应于每个TCP连接或者UDP流)为流量进行排序，然后循环发送每个会话的数据包。</p>
<p>　　<strong>tbf</strong></p>
<p>　　tbf是Token Bucket Filter的简写，适合于把流速降低到某个值。</p>
<p>#####2. 不可分类QDisc的配置</p>
<p>　　如果没有可分类QDisc，不可分类QDisc只能附属于设备的根。它们的用法如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc qdisc add dev DEV root QDISC QDISC-PARAMETERS</div></pre></td></tr></table></figure>
<p>　　要删除一个不可分类QDisc，需要使用如下命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc qdisc del dev DEV root</div></pre></td></tr></table></figure>
<p>　　一个网络接口上如果没有设置QDisc，pfifo_fast就作为缺省的QDisc。</p>
<p>####（2）、CLASSFUL QDISC(分类QDisc)</p>
<p>#####可分类的QDisc包括：</p>
<p>　　<strong>CBQ</strong></p>
<p>　　CBQ是Class Based Queueing(基于类别排队)的缩写。它实现了一个丰富的连接共享类别结构，既有限制(shaping)带宽的能力，也具有带宽优先级管理的能力。带宽限制是通过计算连接的空闲时间完成的。空闲时间的计算标准是数据包离队事件的频率和下层连接(数据链路层)的带宽。</p>
<p>　　<strong>HTB</strong></p>
<p>　　HTB是Hierarchy Token Bucket的缩写。通过在实践基础上的改进，它实现了一个丰富的连接共享类别体系。使用HTB可以很容易地保证每个类别的带宽，虽然它也允许特定的类可以突破带宽上限，占用别的类的带宽。HTB可以通过TBF(Token Bucket Filter)实现带宽限制，也能够划分类别的优先级。</p>
<p>　　<strong>PRIO</strong></p>
<p>　　PRIO QDisc不能限制带宽，因为属于不同类别的数据包是顺序离队的。使用PRIO QDisc可以很容易对流量进行优先级管理，只有属于高优先级类别的数据包全部发送完毕，才会发送属于低优先级类别的数据包。为了方便管理，需要使用iptables或者ipchains处理数据包的服务类型(Type Of Service,ToS)。</p>
<p>###CLASS(类)       </p>
<p>　　某些QDisc(排队规则)可以包含一些类别，不同的类别中可以包含更深入的QDisc(排队规则)，通过这些细分的QDisc还可以为进入的队列的数据包排队。通过设置各种类别数据包的离队次序，QDisc可以为设置网络数据流量的优先级。</p>
<p>###FILTER(过滤器)      </p>
<p>　　Filter(过滤器)用于为数据包分类，决定它们按照何种QDisc进入队列。无论何时数据包进入一个划分子类的类别中，都需要进行分类。分类的方法可以有多种，使用fileter(过滤器)就是其中之一。使用filter(过滤器)分类时，内核会调用附属于这个类(class)的所有过滤器，直到返回一个判决。如果没有判决返回，就作进一步的处理，而处理方式和QDISC有关。需要注意的是，filter(过滤器)是在QDisc内部，它们不能作为主体。</p>
<p>##2.3、操作原理</p>
<p>　　类(Class)组成一个树，每个类都只有一个父类，而一个类可以有多个子类。某些QDisc(例如：CBQ和HTB)允许在运行时动态添加类，而其它的QDisc(例如：PRIO)不允许动态建立类。允许动态添加类的QDisc可以有零个或者多个子类，由它们为数据包排队。此外，每个类都有一个叶子QDisc，默认情况下，这个叶子QDisc使用pfifo的方式排队，我们也可以使用其它类型的QDisc代替这个默认的QDisc。而且，这个叶子叶子QDisc有可以分类，不过每个子类只能有一个叶子QDisc。 当一个数据包进入一个分类QDisc，它会被归入某个子类。</p>
<p>　　我们可以使用以下三种方式为数据包归类，不过不是所有的QDisc都能够使用这三种方式：</p>
<ul>
<li>tc过滤器(tc filter)</li>
</ul>
<p>　　如果过滤器附属于一个类，相关的指令就会对它们进行查询。过滤器能够匹配数据包头所有的域，也可以匹配由ipchains或者iptables做的标记。</p>
<ul>
<li>服务类型(Type of Service)</li>
</ul>
<p>　　某些QDisc有基于服务类型（Type of Service,ToS）的内置的规则为数据包分类。</p>
<ul>
<li>skb-&gt;priority</li>
</ul>
<p>　　用户空间的应用程序可以使用SO_PRIORITY选项在skb-&gt;priority域设置一个类的ID。</p>
<p>　　树的每个节点都可以有自己的过滤器，但是高层的过滤器也可以直接用于其子类。</p>
<p>　　如果数据包没有被成功归类，就会被排到这个类的叶子QDisc的队中。相关细节在各个QDisc的手册页中。</p>
<p>##2.4、命名规则</p>
<p>　　所有的QDisc、类和过滤器都有ID。ID可以手工设置，也可以有内核自动分配。ID由一个主序列号和一个从序列号组成，两个数字用一个冒号分开。</p>
<p>　　<strong>QDISC</strong></p>
<p>　　一个QDisc会被分配一个主序列号，叫做句柄(handle)，然后把从序列号作为类的命名空间。句柄采用象10:一样的表达方式。习惯上，需要为有子类的QDisc显式地分配一个句柄。</p>
<p>　　<strong>类(CLASS)</strong></p>
<p>　　在同一个QDisc里面的类分享这个QDisc的主序列号，但是每个类都有自己的从序列号，叫做类识别符(classid)。类识别符只与父QDisc有关，和父类无关。类的命名习惯和QDisc的相同。</p>
<p>　　<strong>过滤器(FILTER)</strong></p>
<p>　　过滤器的ID有三部分，只有在对过滤器进行散列组织才会用到。详情请参考tc-filters手册页。</p>
<p>##2.5、单位</p>
<p>　　tc命令的所有参数都可以使用浮点数，可能会涉及到以下计数单位。</p>
<table>
<thead>
<tr>
<th>带宽或者流速单位：</th>
</tr>
</thead>
<tbody>
<tr>
<td>kbps</td>
<td>千字节/秒</td>
</tr>
<tr>
<td>mbps</td>
<td>兆字节/秒</td>
</tr>
<tr>
<td>kbit</td>
<td>KBits/秒</td>
</tr>
<tr>
<td>mbit</td>
<td>MBits/秒</td>
</tr>
<tr>
<td>bps或者一个无单位数字</td>
<td>字节数/秒</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>数据的数量单位：</th>
</tr>
</thead>
<tbody>
<tr>
<td>kb或者k</td>
<td>千字节</td>
</tr>
<tr>
<td>mb或者m</td>
<td>兆字节</td>
</tr>
<tr>
<td>mbit</td>
<td>兆bit</td>
</tr>
<tr>
<td>kbit</td>
<td>千bit</td>
</tr>
<tr>
<td>b或者一个无单位数字</td>
<td>字节数</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>时间的计量单位：</th>
</tr>
</thead>
<tbody>
<tr>
<td>s、sec或者secs</td>
<td>秒</td>
</tr>
<tr>
<td>ms、msec或者msecs</td>
<td>分钟</td>
</tr>
<tr>
<td>us、usec、usecs或者一个无单位数字</td>
<td>微秒</td>
</tr>
</tbody>
</table>
<p>#三、TC命令</p>
<p>　　tc可以使用以下命令对QDisc、类和过滤器进行操作：</p>
<ul>
<li>add</li>
</ul>
<p>　　在一个节点里加入一个QDisc、类或者过滤器。添加时，需要传递一个祖先作为参数，传递参数时既可以使用ID也可以直接传递设备的根。如果要建立一个QDisc或者过滤器，可以使用句柄(handle)来命名；如果要建立一个类，可以使用类识别符(classid)来命名。</p>
<ul>
<li>remove</li>
</ul>
<p>　　删除有某个句柄(handle)指定的QDisc，根QDisc(root)也可以删除。被删除QDisc上的所有子类以及附属于各个类的过滤器都会被自动删除。</p>
<ul>
<li>change</li>
</ul>
<p>　　以替代的方式修改某些条目。除了句柄(handle)和祖先不能修改以外，change命令的语法和add命令相同。换句话说，change命令不能一定节点的位置。</p>
<ul>
<li>replace</li>
</ul>
<p>　　对一个现有节点进行近于原子操作的删除/添加。如果节点不存在，这个命令就会建立节点。</p>
<ul>
<li>link</li>
</ul>
<p>　　只适用于DQisc，替代一个现有的节点。</p>
<p>#四、具体操作</p>
<p>　　Linux流量控制主要分为建立队列、建立分类和建立过滤器三个方面。</p>
<p>##4.1、基本实现步骤为：</p>
<ul>
<li>（1） 针对网络物理设备（如以太网卡eth0）绑定一个队列QDisc；</li>
<li>（2） 在该队列上建立分类class；</li>
<li>（3） 为每一分类建立一个基于路由的过滤器filter；</li>
<li>（4） 最后与过滤器相配合，建立特定的路由表。</li>
</ul>
<p>##4.2、环境模拟实例:</p>
<p>　　流量控制器上的以太网卡(eth0) 的IP地址为192.168.1.66，在其上建立一个CBQ队列。假设包的平均大小为1000字节，包间隔发送单元的大小为8字节，可接收冲突的发送最长包数目为20字节。</p>
<p>　　假如有三种类型的流量需要控制: </p>
<ol>
<li>是发往主机1的，其IP地址为192.168.1.24。其流量带宽控制在8Mbit，优先级为2；</li>
<li>是发往主机2的，其IP地址为192.168.1.30。其流量带宽控制在1Mbit，优先级为1；</li>
<li>是发往子网1的，其子网号为192.168.1.0，子网掩码为255.255.255.0。流量带宽控制在1Mbit，优先级为6。</li>
</ol>
<p>###1. 建立队列</p>
<p>　　一般情况下，针对一个网卡只需建立一个队列。</p>
<p>　　将一个cbq队列绑定到网络物理设备eth0上，其编号为1:0；网络物理设备eth0的实际带宽为10 Mbit，包的平均大小为1000字节；包间隔发送单元的大小为8字节，最小传输包大小为64字节。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc qdisc add dev eth0 root handle 1: cbq bandwidth 10Mbit avpkt 1000 cell 8 mpu 64</div></pre></td></tr></table></figure>
<p>###2. 建立分类</p>
<p>　　分类建立在队列之上。</p>
<p>　　一般情况下，针对一个队列需建立一个根分类，然后再在其上建立子分类。对于分类，按其分类的编号顺序起作用，编号小的优先；一旦符合某个分类匹配规则，通过该分类发送数据包，则其后的分类不再起作用。</p>
<p>　　<strong>1） 创建根分类1:1；分配带宽为10Mbit，优先级别为8。</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc class add dev eth0 parent 1:0 classid 1:1 cbq bandwidth 10Mbit rate 10Mbit maxburst 20 allot 1514 prio 8 avpkt 1000 cell 8 weight 1Mbit</div></pre></td></tr></table></figure>
<p>　　该队列的最大可用带宽为10Mbit，实际分配的带宽为10Mbit，可接收冲突的发送最长包数目为20字节；最大传输单元加MAC头的大小为1514字节，优先级别为8，包的平均大小为1000字节，包间隔发送单元的大小为8字节，相应于实际带宽的加权速率为1Mbit。</p>
<p>　　<strong>2）创建分类1:2，其父分类为1:1，分配带宽为8Mbit，优先级别为2。</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc class add dev eth0 parent 1:1 classid 1:2 cbq bandwidth 10Mbit rate 8Mbit maxburst 20 allot 1514 prio 2 avpkt 1000 cell 8 weight 800Kbit split 1:0 bounded</div></pre></td></tr></table></figure>
<p>　　该队列的最大可用带宽为10Mbit，实际分配的带宽为 8Mbit，可接收冲突的发送最长包数目为20字节；最大传输单元加MAC头的大小为1514字节，优先级别为1，包的平均大小为1000字节，包间隔发送单元的大小为8字节，相应于实际带宽的加权速率为800Kbit，分类的分离点为1:0，且不可借用未使用带宽。</p>
<p>　　<strong>3）创建分类1:3，其父分类为1:1，分配带宽为1Mbit，优先级别为1。</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc class add dev eth0 parent 1:1 classid 1:3 cbq bandwidth 10Mbit rate 1Mbit maxburst 20 allot 1514 prio 1 avpkt 1000 cell 8 weight 100Kbit split 1:0</div></pre></td></tr></table></figure>
<p>　　该队列的最大可用带宽为10Mbit，实际分配的带宽为 1Mbit，可接收冲突的发送最长包数目为20字节；最大传输单元加MAC头的大小为1514字节，优先级别为2，包的平均大小为1000字节，包间隔发送单元的大小为8字节，相应于实际带宽的加权速率为100Kbit，分类的分离点为1:0。</p>
<p>　　<strong>4）创建分类1:4，其父分类为1:1，分配带宽为1Mbit，优先级别为6。</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc class add dev eth0 parent 1:1 classid 1:4 cbq bandwidth 10Mbit rate 1Mbit maxburst 20 allot 1514 prio 6 avpkt 1000 cell 8 weight 100Kbit split 1:0</div></pre></td></tr></table></figure>
<p>　　该队列的最大可用带宽为10Mbit，实际分配的带宽为1Mbit，可接收冲突的发送最长包数目为20字节；最大传输单元加MAC头的大小为1514字节，优先级别为6，包的平均大小为1000字节，包间隔发送单元的大小为8字节，相应于实际带宽的加权速率为100Kbit，分类的分离点为1:0。</p>
<p>##4.3. 建立过滤器 </p>
<p>　　过滤器主要服务于分类。</p>
<p>一般只需针对根分类提供一个过滤器，然后为每个子分类提供路由映射。</p>
<p><strong>1） 应用路由分类器到cbq队列的根，父分类编号为1:0；过滤协议为ip，优先级别为100，过滤器为基于路由表。</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc filter add dev eth0 parent 1:0 protocol ip prio 100 route</div></pre></td></tr></table></figure>
<p><strong>2） 建立路由映射分类1:2, 1:3, 1:4</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">tc filter add dev eth0 parent 1:0 protocol ip prio 100 route to 2 flowid 1:2</div><div class="line"></div><div class="line">tc filter add dev eth0 parent 1:0 protocol ip prio 100 route to 3 flowid 1:3</div><div class="line"></div><div class="line">tc filter add dev eth0 parent 1:0 protocol ip prio 100 route to 4 flowid 1:4</div></pre></td></tr></table></figure>
<p>##4.4.建立路由</p>
<p>　　该路由是与前面所建立的路由映射一一对应。</p>
<p>　　<strong>1） 发往主机192.168.1.24的数据包通过分类2转发(分类2的速率8Mbit)</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ip route add 192.168.1.24 dev eth0 via 192.168.1.66 realm 2</div></pre></td></tr></table></figure>
<p>　　<strong>2） 发往主机192.168.1.30的数据包通过分类3转发(分类3的速率1Mbit)</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ip route add 192.168.1.30 dev eth0 via 192.168.1.66 realm 3</div></pre></td></tr></table></figure>
<p>　　<strong>3）发往子网192.168.1.0/24的数据包通过分类4转发(分类4的速率1Mbit)</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ip route add 192.168.1.0/24 dev eth0 via 192.168.1.66 realm 4</div></pre></td></tr></table></figure>
<p>　　<strong>注</strong>：一般对于流量控制器所直接连接的网段建议使用IP主机地址流量控制限制，不要使用子网流量控制限制。如一定需要对直连子网使用子网流量控制限制，则在建立该子网的路由映射前，需将原先由系统建立的路由删除，才可完成相应步骤。</p>
<p>##4.5. 监视</p>
<p>　　主要包括对现有队列、分类、过滤器和路由的状况进行监视。</p>
<p>　　<strong>1）显示队列的状况</strong></p>
<p>　　简单显示指定设备(这里为eth0)的队列状况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tc qdisc ls dev eth0</div><div class="line"></div><div class="line">qdisc cbq 1: rate 10Mbit (bounded,isolated) prio no-transmit</div></pre></td></tr></table></figure>
<p>　　详细显示指定设备(这里为eth0)的队列状况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc -s qdisc ls dev eth0</div></pre></td></tr></table></figure>
<p>　　这里主要显示了通过该队列发送了13232个数据包，数据流量为7646731个字节，丢弃的包数目为0，超过速率限制的包数目为0。</p>
<p>　　<strong>2）显示分类的状况</strong></p>
<p>　　简单显示指定设备(这里为eth0)的分类状况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc class ls dev eth0</div></pre></td></tr></table></figure>
<p>　　详细显示指定设备(这里为eth0)的分类状况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc -s class ls dev eth0</div></pre></td></tr></table></figure>
<p>　　这里主要显示了通过不同分类发送的数据包，数据流量，丢弃的包数目，超过速率限制的包数目等等。其中根分类(class cbq 1:0)的状况应与队列的状况类似。</p>
<p>　　例如，分类class cbq 1:4发送了8076个数据包，数据流量为5552879个字节，丢弃的包数目为0，超过速率限制的包数目为0。</p>
<p>　　<strong>3）显示过滤器的状况</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tc -s filter ls dev eth0</div></pre></td></tr></table></figure>
<p>　　这里flowid 1:2代表分类class cbq 1:2，to 2代表通过路由2发送。</p>
<p>　　<strong>4）显示现有路由的状况</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ip route</div></pre></td></tr></table></figure>
<p>　　如上所示，结尾包含有realm的显示行是起作用的路由过滤器。</p>
<p>#五、实例脚本</p>
<p>##5.1 tc限速</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#! /bin/sh</span></div><div class="line"></div><div class="line">touch  /var/lock/subsys/<span class="built_in">local</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span>  1  &gt; /proc/sys/net/ipv4/ip_forward （激活转发）</div><div class="line"></div><div class="line">route add default  gw  10.0.0.0  (这是加入电信网关，如果你已设了不用这条）</div><div class="line"></div><div class="line">DOWNLOAD=640Kbit        (640/8 =80K ,我这里限制下载最高速度只能80K）</div><div class="line">UPLOAD=640Kbit          (640/8 =80K,上传速度也限制在80K）</div><div class="line">INET=192.168.0.         (设置网段，根据你的情况填）</div><div class="line">IPS=1                   (这个意思是从192.168.0.1开始）</div><div class="line">IPE=200                 (我这设置是从IP为192.168.0.1-200这个网段限速，根据自已的需要改）</div><div class="line">ServerIP=253            (网关IP）</div><div class="line">IDEV=eth0</div><div class="line">ODEV=eth1</div><div class="line"></div><div class="line">/sbin/tc  qdisc  del  dev  <span class="variable">$IDEV</span> root handle 10:</div><div class="line">/sbin/tc  qdisc  del  dev  <span class="variable">$ODEV</span>  root handle  20:</div><div class="line">/sbin/tc  qdisc  add  dev <span class="variable">$IDEV</span>  root  handle  10: cbq  bandwidth  100Mbit avpkt  1000</div><div class="line">/sbin/tc  qdisc  add  dev  <span class="variable">$ODEV</span>  root  handle  20: cbq bandwidth  1Mbit  avpkt  1000</div><div class="line">/sbin/tc  class  add  dev <span class="variable">$IDEV</span>  parent 10:0  classid  10:1  cbq  bandwidth  100Mbit  rate 100Mbit  allot 1514  weight  1Mbit  prio  8  maxburst  20  avpkt  1000</div><div class="line">/sbin/tc  class  add  dev  <span class="variable">$ODEV</span>  parent  20:0  classid  20:1 cbq  bandwidth  1Mbit  rate  1Mbit  allot  1514  weitht  10Kbit  prio  8  maxburst  20  avpkt  1000</div><div class="line"></div><div class="line">COUNTER=<span class="variable">$IPS</span></div><div class="line"><span class="keyword">while</span>  [  <span class="variable">$COUNTER</span>  -le  <span class="variable">$IPE</span>  ]</div><div class="line">    <span class="keyword">do</span></div><div class="line">/sbin/tc  class  add  dev  <span class="variable">$IDEV</span>  parent  10:1  classid  10:1<span class="variable">$COUNTER</span>  cbq  banwidth  100Mbit  rate  </div><div class="line"><span class="variable">$DOWNLOAD</span>  allot  1514  weight  20Kbit  prio  5  maxburst  20  avpkt  1000  bounded</div><div class="line">/sbin/tc  qdisc  add  dev  <span class="variable">$IDEV</span>  parent  10:1<span class="variable">$COUNTER</span>  sfq  quantum  1514b  perturb15</div><div class="line"></div><div class="line">/sbin/tc  filter  add  dev  <span class="variable">$IDEV</span>  parent  10:0  protocol  ip  prio  100  u32  match  ipdst  <span class="variable">$INET</span><span class="variable">$COUNTER</span>  flowid  10:1<span class="variable">$COUNTER</span></div><div class="line">      COUNTER=` expr  <span class="variable">$COUNTER</span>  +  1  `</div><div class="line"><span class="keyword">done</span></div><div class="line"></div><div class="line">iptables  -t  nat  -A  POSTROUTING  -o  eth1  <span class="_">-s</span>  192.168.0.0/24  -J  MASQUERADE</div></pre></td></tr></table></figure>
<p>##5.2 模型</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line">tc qdisc del dev eth7 root &amp;&gt; /dev/null</div><div class="line">tc qdisc del dev eth8 root &amp;&gt; /dev/null</div><div class="line"></div><div class="line"><span class="comment">#Add qdisc</span></div><div class="line">tc qdisc add dev eth7 root handle 10: htb default 9998</div><div class="line">tc qdisc add dev eth8 root handle 10: htb default 9998</div><div class="line"></div><div class="line"><span class="comment">#Add htb root node</span></div><div class="line">tc class add dev eth7 parent 10: classid 10:9999 htb rate 1000000kbit ceil 1000000kbit</div><div class="line">tc class add dev eth8 parent 10: classid 10:9999 htb rate 1000000kbit ceil 1000000kbit</div><div class="line"></div><div class="line"><span class="comment">#Add htb fake default node here</span></div><div class="line">tc class add dev eth7 parent 10:9999 classid 10:9998 htb rate 1000000kbit ceil 1000000kbit</div><div class="line">tc class add dev eth8 parent 10:9999 classid 10:9998 htb rate 1000000kbit ceil 1000000kbit</div><div class="line"></div><div class="line"><span class="comment">#Add rule node</span></div><div class="line">tc class add dev eth7 parent 10:9999 classid 10:3 htb rate 1kbit ceil 50kbit</div><div class="line">tc filter add dev eth7 parent 10: protocol ip handle 3 fw classid 10:3</div><div class="line">tc class add dev eth8 parent 10:9999 classid 10:3 htb rate 1kbit ceil 50kbit</div><div class="line">tc filter add dev eth8 parent 10: protocol ip handle 3 fw classid 10:3</div><div class="line"></div><div class="line"><span class="comment">#Add htb real default node here</span></div><div class="line">tc class change dev eth7 classid 10:9998 htb rate 1kbit ceil 1000000kbit</div><div class="line">tc class change dev eth8 classid 10:9998 htb rate 1kbit ceil 1000000kbit</div></pre></td></tr></table></figure>
<p>##5.3 限制一个IP上传下载速度</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment">#  tc uses the following units when passed as a parameter.</span></div><div class="line"><span class="comment">#  kbps: Kilobytes per second</span></div><div class="line"><span class="comment">#  mbps: Megabytes per second</span></div><div class="line"><span class="comment">#  kbit: Kilobits per second</span></div><div class="line"><span class="comment">#  mbit: Megabits per second</span></div><div class="line"><span class="comment">#  bps: Bytes per second</span></div><div class="line"><span class="comment">#       Amounts of data can be specified in:</span></div><div class="line"><span class="comment">#       kb or k: Kilobytes</span></div><div class="line"><span class="comment">#       mb or m: Megabytes</span></div><div class="line"><span class="comment">#       mbit: Megabits</span></div><div class="line"><span class="comment">#       kbit: Kilobits</span></div><div class="line"><span class="comment">#  To get the byte figure from bits, divide the number by 8 bit</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Name of the traffic control command.</span></div><div class="line">TC=/sbin/tc</div><div class="line"></div><div class="line"><span class="comment"># The network interface we're planning on limiting bandwidth.</span></div><div class="line">IF=em1             <span class="comment"># Interface</span></div><div class="line"></div><div class="line"><span class="comment"># Download limit (in mega bits)</span></div><div class="line">DNLD=80mbit          <span class="comment"># DOWNLOAD Limit</span></div><div class="line"></div><div class="line"><span class="comment"># Upload limit (in mega bits)</span></div><div class="line">UPLD=80mbit          <span class="comment"># UPLOAD Limit</span></div><div class="line"></div><div class="line"><span class="comment"># IP address of the machine we are controlling</span></div><div class="line">IP=125.64.15.21     <span class="comment"># Host IP</span></div><div class="line"></div><div class="line"><span class="comment"># Filter options for limiting the intended interface.</span></div><div class="line">U32=<span class="string">"<span class="variable">$TC</span> filter add dev <span class="variable">$IF</span> protocol ip parent 1:0 prio 1 u32"</span></div><div class="line"></div><div class="line"><span class="function"><span class="title">start</span></span>() &#123;</div><div class="line"></div><div class="line"><span class="comment"># We'll use Hierarchical Token Bucket (HTB) to shape bandwidth.</span></div><div class="line"><span class="comment"># For detailed configuration options, please consult Linux man</span></div><div class="line"><span class="comment"># page.</span></div><div class="line"></div><div class="line">    <span class="variable">$TC</span> qdisc add dev <span class="variable">$IF</span> root handle 1: htb default 30</div><div class="line">    <span class="variable">$TC</span> class add dev <span class="variable">$IF</span> parent 1: classid 1:1 htb rate <span class="variable">$DNLD</span></div><div class="line">    <span class="variable">$TC</span> class add dev <span class="variable">$IF</span> parent 1: classid 1:2 htb rate <span class="variable">$UPLD</span></div><div class="line">    <span class="variable">$U32</span> match ip dst <span class="variable">$IP</span>/32 flowid 1:1</div><div class="line">    <span class="variable">$U32</span> match ip src <span class="variable">$IP</span>/32 flowid 1:2</div><div class="line"></div><div class="line"><span class="comment"># The first line creates the root qdisc, and the next two lines</span></div><div class="line"><span class="comment"># create two child qdisc that are to be used to shape download</span></div><div class="line"><span class="comment"># and upload bandwidth.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The 4th and 5th line creates the filter to match the interface.</span></div><div class="line"><span class="comment"># The 'dst' IP address is used to limit download speed, and the</span></div><div class="line"><span class="comment"># 'src' IP address is used to limit upload speed.</span></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">stop</span></span>() &#123;</div><div class="line"></div><div class="line"><span class="comment"># Stop the bandwidth shaping.</span></div><div class="line">    <span class="variable">$TC</span> qdisc del dev <span class="variable">$IF</span> root</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">restart</span></span>() &#123;</div><div class="line"></div><div class="line"><span class="comment"># Self-explanatory.</span></div><div class="line">    stop</div><div class="line">    sleep 1</div><div class="line">    start</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="title">show</span></span>() &#123;</div><div class="line"></div><div class="line"><span class="comment"># Display status of traffic control status.</span></div><div class="line">    <span class="variable">$TC</span> <span class="_">-s</span> qdisc ls dev <span class="variable">$IF</span></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></div><div class="line"></div><div class="line">  start)</div><div class="line"></div><div class="line">    <span class="built_in">echo</span> -n <span class="string">"Starting bandwidth shaping: "</span></div><div class="line">    start</div><div class="line">    <span class="built_in">echo</span> <span class="string">"done"</span></div><div class="line">    ;;</div><div class="line"></div><div class="line">  stop)</div><div class="line"></div><div class="line">    <span class="built_in">echo</span> -n <span class="string">"Stopping bandwidth shaping: "</span></div><div class="line">    stop</div><div class="line">    <span class="built_in">echo</span> <span class="string">"done"</span></div><div class="line">    ;;</div><div class="line"></div><div class="line">  restart)</div><div class="line"></div><div class="line">    <span class="built_in">echo</span> -n <span class="string">"Restarting bandwidth shaping: "</span></div><div class="line">    restart</div><div class="line">    <span class="built_in">echo</span> <span class="string">"done"</span></div><div class="line">    ;;</div><div class="line"></div><div class="line">  show)</div><div class="line"></div><div class="line">    <span class="built_in">echo</span> <span class="string">"Bandwidth shaping status for <span class="variable">$IF</span>:"</span></div><div class="line">    show</div><div class="line">    <span class="built_in">echo</span> <span class="string">""</span></div><div class="line">    ;;</div><div class="line"></div><div class="line">  *)</div><div class="line"></div><div class="line">    <span class="built_in">pwd</span>=$(<span class="built_in">pwd</span>)</div><div class="line">    <span class="built_in">echo</span> <span class="string">"Usage: tc.bash &#123;start|stop|restart|show&#125;"</span></div><div class="line">    ;;</div><div class="line"></div><div class="line"><span class="keyword">esac</span></div><div class="line"></div><div class="line"><span class="built_in">exit</span> 0</div></pre></td></tr></table></figure>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/unix-like">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&text="><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&is_video=false&description="><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=&body=Check out this article: http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&title="><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.unix-like.com/2017/05/25/application/tc命令Linux基于IP进行流量限速/&name=&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 肖星
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="https://github.com/unix-like">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


